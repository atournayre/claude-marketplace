# Consistance des Scopes GitHub

## ‚ö†Ô∏è IMPORTANT: Source de V√©rit√© Unique

Pour garantir la coh√©rence des scopes GitHub demand√©s, **UNE SEULE source de v√©rit√© existe**:

### üìç Fichier de R√©f√©rence

```
scripts/gh_auth_setup.sh
```

**Array `REQUIRED_SCOPES`** ligne ~4-10:

```bash
REQUIRED_SCOPES=(
    "repo"           # Acc√®s complet aux repos (PRs, commits, etc.)
    "read:org"       # Lecture infos organisation
    "read:project"   # Lecture projets GitHub
    "project"        # √âcriture/assignation aux projets
    "gist"           # Gestion des gists
)
```

## üîí R√®gles Strictes

### DO ‚úÖ

1. **Modifier uniquement `gh_auth_setup.sh`** pour ajouter/retirer des scopes
2. **Utiliser syst√©matiquement** `bash gh_auth_setup.sh` pour renouveler l'auth
3. **V√©rifier les scopes** √† chaque d√©but de workflow (√âtape 1.5 dans SKILL.md)
4. **Documenter** dans ce fichier toute modification de scopes

### DON'T ‚ùå

1. ‚ùå **NE JAMAIS** utiliser `gh auth refresh -s <scope>` manuellement sans passer par le script
2. ‚ùå **NE JAMAIS** hard-coder les scopes dans SKILL.md ou ailleurs
3. ‚ùå **NE JAMAIS** supposer qu'un scope est pr√©sent sans v√©rification

## üìã Checklist Modification Scopes

Si ajout/retrait de scope n√©cessaire:

- [ ] Modifier `REQUIRED_SCOPES` dans `scripts/gh_auth_setup.sh`
- [ ] Mettre √† jour section "Scopes Requis" dans `SKILL.md`
- [ ] Mettre √† jour tableau dans `README.md`
- [ ] Documenter dans ce fichier (section Historique)
- [ ] Tester avec `bash scripts/gh_auth_setup.sh`
- [ ] V√©rifier avec `gh auth status`
- [ ] Tester le workflow complet

## üìú Historique des Modifications

### 2025-11-05 - Initialisation

**Scopes d√©finis**: `repo`, `read:org`, `read:project`, `project`, `gist`

**Contexte**: Cr√©ation du syst√®me de consistance suite √† oubli intermittent de scopes lors des renouvellements d'authentification.

**Changements**:
- Cr√©ation `scripts/gh_auth_setup.sh` (script centralisant TOUS les scopes)
- Ajout √âtape 1.5 dans `SKILL.md` (v√©rification automatique scopes)
- Cr√©ation `README.md` (documentation compl√®te)
- Cr√©ation `.scope-consistency.md` (ce fichier - r√®gles de coh√©rence)

**Impact**: Garantit qu'aucun scope ne sera oubli√© lors des futurs renouvellements.

---

### Template Modification Future

```markdown
### YYYY-MM-DD - [Titre Modification]

**Scopes modifi√©s**: `scope1`, `scope2`

**Contexte**: [Raison de la modification]

**Changements**:
- [D√©tail changement 1]
- [D√©tail changement 2]

**Impact**: [Impact sur le workflow]
```

## üîç D√©bogage

### Sympt√¥me: "Scopes manquants" malgr√© renouvellement r√©cent

**Diagnostic**:
```bash
# 1. V√©rifier scopes actuels
gh auth status | grep "Token scopes"

# 2. Comparer avec REQUIRED_SCOPES
cat scripts/gh_auth_setup.sh | grep -A 10 "REQUIRED_SCOPES"
```

**Solution**:
```bash
# Re-run le script de setup
bash scripts/gh_auth_setup.sh
```

### Sympt√¥me: Script fonctionne mais assignation projet √©choue

**Diagnostic**:
```bash
# V√©rifier que 'project' ET pas seulement 'read:project'
gh auth status | grep -o "project"
```

**Cause Probable**: Token ancien avec seulement `read:project`

**Solution**:
```bash
# Logout complet puis re-setup
gh auth logout
bash scripts/gh_auth_setup.sh
```

## üìö R√©f√©rences

- Script source: `scripts/gh_auth_setup.sh`
- Workflow: `SKILL.md` (√âtape 1.5)
- Documentation: `README.md`
- GitHub Scopes Doc: https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/scopes-for-oauth-apps
